/*
	Redactor v8.2.2
	Updated: January 17, 2013

	http://redactorjs.com/

	Copyright (c) 2009-2013, Imperavi Inc.
	License: http://redactorjs.com/license/

	Usage: $('#content').redactor();
*/
var rwindow,rdocument;if(void 0===RELANG)var RELANG={};var RLANG={html:"HTML",video:"Insert Video",image:"Insert Image",table:"Table",link:"Link",link_insert:"Insert link",unlink:"Unlink",formatting:"Formatting",paragraph:"Paragraph",quote:"Quote",code:"Code",header1:"Header 1",header2:"Header 2",header3:"Header 3",header4:"Header 4",bold:"Bold",italic:"Italic",fontcolor:"Font Color",backcolor:"Back Color",unorderedlist:"Unordered List",orderedlist:"Ordered List",outdent:"Outdent",indent:"Indent",cancel:"Cancel",insert:"Insert",save:"Save",_delete:"Delete",insert_table:"Insert Table",insert_row_above:"Add Row Above",insert_row_below:"Add Row Below",insert_column_left:"Add Column Left",insert_column_right:"Add Column Right",delete_column:"Delete Column",delete_row:"Delete Row",delete_table:"Delete Table",rows:"Rows",columns:"Columns",add_head:"Add Head",delete_head:"Delete Head",title:"Title",image_position:"Position",none:"None",left:"Left",right:"Right",image_web_link:"Image Web Link",text:"Text",mailto:"Email",web:"URL",video_html_code:"Video Embed Code",file:"Insert File",upload:"Upload",download:"Download",choose:"Choose",or_choose:"Or choose",drop_file_here:"Drop file here",align_left:"Align text to the left",align_center:"Center text",align_right:"Align text to the right",align_justify:"Justify text",horizontalrule:"Insert Horizontal Rule",deleted:"Deleted",anchor:"Anchor",link_new_tab:"Open link in new tab",underline:"Underline",alignment:"Alignment"};!function(t){jQuery.fn.redactor=function(i){return this.each(function(){var o=t(this),r=o.data("redactor");r||o.data("redactor",r=new e(this,i))})};var e=function(e,i){this.$el=t(e),void 0!==i&&void 0!==i.lang&&"en"!==i.lang&&void 0!==RELANG[i.lang]&&(RLANG=RELANG[i.lang]),this.opts=t.extend({iframe:!1,css:!1,lang:"en",direction:"ltr",callback:!1,keyupCallback:!1,keydownCallback:!1,execCommandCallback:!1,plugins:!1,cleanup:!0,focus:!1,tabindex:!1,autoresize:!0,minHeight:!1,fixed:!1,fixedTop:0,fixedBox:!1,source:!0,shortcuts:!0,mobile:!0,air:!1,wym:!1,convertLinks:!0,convertDivs:!0,protocol:"http://",autosave:!1,autosaveCallback:!1,interval:60,imageGetJson:!1,imageUpload:!1,imageUploadCallback:!1,imageUploadErrorCallback:!1,fileUpload:!1,fileUploadCallback:!1,fileUploadErrorCallback:!1,uploadCrossDomain:!1,uploadFields:!1,observeImages:!0,overlay:!0,allowedTags:["form","input","button","select","option","datalist","output","textarea","fieldset","legend","section","header","hgroup","aside","footer","article","details","nav","progress","time","canvas","code","span","div","label","a","br","p","b","i","del","strike","u","img","video","source","track","audio","iframe","object","embed","param","blockquote","mark","cite","small","ul","ol","li","hr","dl","dt","dd","sup","sub","big","pre","code","figure","figcaption","strong","em","table","tr","td","th","tbody","thead","tfoot","h1","h2","h3","h4","h5","h6"],toolbarExternal:!1,buttonsCustom:{},buttonsAdd:[],buttons:["html","|","formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","image","video","file","table","link","|","fontcolor","backcolor","|","alignment","|","horizontalrule"],airButtons:["formatting","|","bold","italic","deleted","|","unorderedlist","orderedlist","outdent","indent","|","fontcolor","backcolor"],formattingTags:["p","blockquote","pre","h1","h2","h3","h4"],activeButtons:["deleted","italic","bold","underline","unorderedlist","orderedlist"],activeButtonsStates:{b:"bold",strong:"bold",i:"italic",em:"italic",del:"deleted",strike:"deleted",ul:"unorderedlist",ol:"orderedlist",u:"underline"},colors:["#ffffff","#000000","#eeece1","#1f497d","#4f81bd","#c0504d","#9bbb59","#8064a2","#4bacc6","#f79646","#ffff00","#f2f2f2","#7f7f7f","#ddd9c3","#c6d9f0","#dbe5f1","#f2dcdb","#ebf1dd","#e5e0ec","#dbeef3","#fdeada","#fff2ca","#d8d8d8","#595959","#c4bd97","#8db3e2","#b8cce4","#e5b9b7","#d7e3bc","#ccc1d9","#b7dde8","#fbd5b5","#ffe694","#bfbfbf","#3f3f3f","#938953","#548dd4","#95b3d7","#d99694","#c3d69b","#b2a2c7","#b7dde8","#fac08f","#f2c314","#a5a5a5","#262626","#494429","#17365d","#366092","#953734","#76923c","#5f497a","#92cddc","#e36c09","#c09100","#7f7f7f","#0c0c0c","#1d1b10","#0f243e","#244061","#632423","#4f6128","#3f3151","#31859b","#974806","#7f6000"],emptyHtml:"<p><br /></p>",buffer:!1,visual:!0,modal_file:String()+'<div id="redactor_modal_content"><form id="redactorUploadFileForm" method="post" action="" enctype="multipart/form-data"><label>Name (optional)</label><input type="text" id="redactor_filename" class="redactor_input" /><div style="margin-top: 7px;"><input type="file" id="redactor_file" name="file" /></div></form><br></div>',modal_image_edit:String()+'<div id="redactor_modal_content"><label>'+RLANG.title+'</label><input id="redactor_file_alt" class="redactor_input" /><label>'+RLANG.link+'</label><input id="redactor_file_link" class="redactor_input" /><label>'+RLANG.image_position+'</label><select id="redactor_form_image_align"><option value="none">'+RLANG.none+'</option><option value="left">'+RLANG.left+'</option><option value="right">'+RLANG.right+'</option></select></div><div id="redactor_modal_footer"><a href="javascript:void(null);" id="redactor_image_delete_btn" class="redactor_modal_btn">'+RLANG._delete+'</a>&nbsp;&nbsp;&nbsp;<a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="save" class="redactor_modal_btn" id="redactorSaveBtn" value="'+RLANG.save+'" /></div>',modal_image:String()+'<div id="redactor_modal_content"><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">'+RLANG.upload+'</a><a href="javascript:void(null);">'+RLANG.choose+'</a><a href="javascript:void(null);">'+RLANG.link+'</a></div><form id="redactorInsertImageForm" method="post" action="" enctype="multipart/form-data"><div id="redactor_tab1" class="redactor_tab"><input type="file" id="redactor_file" name="file" /></div><div id="redactor_tab2" class="redactor_tab" style="display: none;"><div id="redactor_image_box"></div></div></form><div id="redactor_tab3" class="redactor_tab" style="display: none;"><label>'+RLANG.image_web_link+'</label><input type="text" name="redactor_file_link" id="redactor_file_link" class="redactor_input"  /></div></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_upload_btn" value="'+RLANG.insert+'" /></div>',modal_link:String()+'<div id="redactor_modal_content"><form id="redactorInsertLinkForm" method="post" action=""><div id="redactor_tabs"><a href="javascript:void(null);" class="redactor_tabs_act">URL</a><a href="javascript:void(null);">Email</a><a href="javascript:void(null);">'+RLANG.anchor+'</a></div><input type="hidden" id="redactor_tab_selected" value="1" /><div class="redactor_tab" id="redactor_tab1"><label>URL</label><input type="text" id="redactor_link_url" class="redactor_input"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_url_text" /><label><input type="checkbox" id="redactor_link_blank"> '+RLANG.link_new_tab+'</label></div><div class="redactor_tab" id="redactor_tab2" style="display: none;"><label>Email</label><input type="text" id="redactor_link_mailto" class="redactor_input" /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_mailto_text" /></div><div class="redactor_tab" id="redactor_tab3" style="display: none;"><label>'+RLANG.anchor+'</label><input type="text" class="redactor_input" id="redactor_link_anchor"  /><label>'+RLANG.text+'</label><input type="text" class="redactor_input redactor_link_text" id="redactor_link_anchor_text" /></div></form></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_link_btn" value="'+RLANG.insert+'" /></div>',modal_table:String()+'<div id="redactor_modal_content"><label>'+RLANG.rows+'</label><input type="text" size="5" value="2" id="redactor_table_rows" /><label>'+RLANG.columns+'</label><input type="text" size="5" value="3" id="redactor_table_columns" /></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" name="upload" class="redactor_modal_btn" id="redactor_insert_table_btn" value="'+RLANG.insert+'" /></div>',modal_video:String()+'<div id="redactor_modal_content"><form id="redactorInsertVideoForm"><label>'+RLANG.video_html_code+'</label><textarea id="redactor_insert_video_area" style="width: 99%; height: 160px;"></textarea></form></div><div id="redactor_modal_footer"><a href="javascript:void(null);" class="redactor_modal_btn redactor_btn_modal_close">'+RLANG.cancel+'</a><input type="button" class="redactor_modal_btn" id="redactor_insert_video_btn" value="'+RLANG.insert+'" /></div>',toolbar:{html:{title:RLANG.html,func:"toggle"},formatting:{title:RLANG.formatting,func:"show",dropdown:{p:{title:RLANG.paragraph,exec:"formatblock"},blockquote:{title:RLANG.quote,exec:"formatblock",className:"redactor_format_blockquote"},pre:{title:RLANG.code,exec:"formatblock",className:"redactor_format_pre"},h1:{title:RLANG.header1,exec:"formatblock",className:"redactor_format_h1"},h2:{title:RLANG.header2,exec:"formatblock",className:"redactor_format_h2"},h3:{title:RLANG.header3,exec:"formatblock",className:"redactor_format_h3"},h4:{title:RLANG.header4,exec:"formatblock",className:"redactor_format_h4"}}},bold:{title:RLANG.bold,exec:"bold"},italic:{title:RLANG.italic,exec:"italic"},deleted:{title:RLANG.deleted,exec:"strikethrough"},underline:{title:RLANG.underline,exec:"underline"},unorderedlist:{title:"&bull; "+RLANG.unorderedlist,exec:"insertunorderedlist"},orderedlist:{title:"1. "+RLANG.orderedlist,exec:"insertorderedlist"},outdent:{title:"< "+RLANG.outdent,exec:"outdent"},indent:{title:"> "+RLANG.indent,exec:"indent"},image:{title:RLANG.image,func:"showImage"},video:{title:RLANG.video,func:"showVideo"},file:{title:RLANG.file,func:"showFile"},table:{title:RLANG.table,func:"show",dropdown:{insert_table:{title:RLANG.insert_table,func:"showTable"},separator_drop1:{name:"separator"},insert_row_above:{title:RLANG.insert_row_above,func:"insertRowAbove"},insert_row_below:{title:RLANG.insert_row_below,func:"insertRowBelow"},insert_column_left:{title:RLANG.insert_column_left,func:"insertColumnLeft"},insert_column_right:{title:RLANG.insert_column_right,func:"insertColumnRight"},separator_drop2:{name:"separator"},add_head:{title:RLANG.add_head,func:"addHead"},delete_head:{title:RLANG.delete_head,func:"deleteHead"},separator_drop3:{name:"separator"},delete_column:{title:RLANG.delete_column,func:"deleteColumn"},delete_row:{title:RLANG.delete_row,func:"deleteRow"},delete_table:{title:RLANG.delete_table,func:"deleteTable"}}},link:{title:RLANG.link,func:"show",dropdown:{link:{title:RLANG.link_insert,func:"showLink"},unlink:{title:RLANG.unlink,exec:"unlink"}}},fontcolor:{title:RLANG.fontcolor,func:"show"},backcolor:{title:RLANG.backcolor,func:"show"},alignment:{title:RLANG.alignment,func:"show",dropdown:{alignleft:{title:RLANG.align_left,exec:"JustifyLeft"},aligncenter:{title:RLANG.align_center,exec:"JustifyCenter"},alignright:{title:RLANG.align_right,exec:"JustifyRight"},justify:{title:RLANG.align_justify,exec:"JustifyFull"}}},alignleft:{exec:"JustifyLeft",title:RLANG.align_left},aligncenter:{exec:"JustifyCenter",title:RLANG.align_center},alignright:{exec:"JustifyRight",title:RLANG.align_right},justify:{exec:"JustifyFull",title:RLANG.align_justify},horizontalrule:{exec:"inserthorizontalrule",title:RLANG.horizontalrule}}},i,this.$el.data()),this.dropdowns=[],this.init()};e.prototype={init:function(){if(this.height=this.$el.css("height"),this.width=this.$el.css("width"),rdocument=this.document=document,rwindow=this.window=window,!1===this.opts.mobile&&this.isMobile())return this.build(!0),!1;if(this.opts.iframe&&(this.opts.autoresize=!1),this.opts.air)this.opts.buttons=this.opts.airButtons;else if(!1!==this.opts.toolbar){if(!1===this.opts.source){var e=this.opts.buttons.indexOf("html"),i=this.opts.buttons[e+1];this.opts.buttons.splice(e,1),void 0!==i&&"|"===i&&this.opts.buttons.splice(e,1)}t.extend(this.opts.toolbar,this.opts.buttonsCustom),t.each(this.opts.buttonsAdd,t.proxy(function(t,e){this.opts.buttons.push(e)},this))}!1!==this.opts.toolbar&&t.each(this.opts.toolbar.formatting.dropdown,t.proxy(function(e,i){"-1"==t.inArray(e,this.opts.formattingTags)&&delete this.opts.toolbar.formatting.dropdown[e]},this)),this.build(!1,function(){if(this.enableAir(),this.buildToolbar(),"object"==typeof this.opts.plugins&&t.each(this.opts.plugins,t.proxy(function(e,i){void 0!==RedactorPlugins[i]&&(t.extend(this,RedactorPlugins[i]),void 0!==RedactorPlugins[i].init&&this.init())},this)),!1!==this.opts.activeButtons&&!1!==this.opts.toolbar){var e=t.proxy(function(){this.observeFormatting()},this);this.$editor.click(e).keyup(e)}var i=!1;if(this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome")&&this.browser("version").split(".")[0]<536&&(i=!0),!1===this.isMobile(!0)&&!1===i&&this.$editor.bind("paste",t.proxy(function(e){if(!1===this.opts.cleanup)return!0;this.pasteRunning=!0,this.setBuffer(),!0===this.opts.autoresize?this.saveScroll=this.document.body.scrollTop:this.saveScroll=this.$editor.scrollTop();var i=this.extractContent();setTimeout(t.proxy(function(){var t=this.extractContent();this.$editor.append(i),this.restoreSelection();var e=this.getFragmentHtml(t);this.pasteCleanUp(e),this.pasteRunning=!1},this),1)},this)),this.keyup(),this.keydown(),!1!==this.opts.autosave&&this.autoSave(),setTimeout(t.proxy(function(){this.observeImages(),this.observeTables()},this),1),this.browser("mozilla")){this.$editor.click(t.proxy(function(){this.saveSelection()},this));try{this.document.execCommand("enableObjectResizing",!1,!1),this.document.execCommand("enableInlineTableEditing",!1,!1)}catch(t){}}this.opts.focus&&setTimeout(t.proxy(function(){this.$editor.focus()},this),1),this.opts.fixed&&(this.observeScroll(),t(document).scroll(t.proxy(this.observeScroll,this))),"function"==typeof this.opts.callback&&this.opts.callback(this),!1!==this.opts.toolbar&&this.$toolbar.find("a").attr("tabindex","-1")})},shortcuts:function(t,e){t.preventDefault(),this.execCommand(e,!1)},keyup:function(){this.$editor.keyup(t.proxy(function(t){var e=t.keyCode||t.which;if(this.browser("mozilla")&&!this.pasteRunning&&this.saveSelection(),"function"==typeof this.opts.keyupCallback&&this.opts.keyupCallback(this,t),8===e||46===e)return this.observeImages(),this.formatEmpty(t);13!==e||t.shiftKey||t.ctrlKey||t.metaKey||(this.browser("webkit")&&this.formatNewLine(t),this.opts.convertLinks&&this.$editor.linkify()),this.syncCode()},this))},keydown:function(){this.$editor.keydown(t.proxy(function(e){var i=e.keyCode||e.which,o=this.getParentNode(),r=this.getCurrentNode(),a=!1,s=e.ctrlKey||e.metaKey;if(!o&&!r||"PRE"!==t(o).get(0).tagName&&"PRE"!==t(r).get(0).tagName||(a=!0),"function"==typeof this.opts.keydownCallback&&this.opts.keydownCallback(this,e),s&&this.opts.shortcuts&&(90===i?!1!==this.opts.buffer?(e.preventDefault(),this.getBuffer()):e.shiftKey?this.shortcuts(e,"redo"):this.shortcuts(e,"undo"):77===i?this.shortcuts(e,"removeFormat"):66===i?this.shortcuts(e,"bold"):73===i?this.shortcuts(e,"italic"):74===i?this.shortcuts(e,"insertunorderedlist"):75===i?this.shortcuts(e,"insertorderedlist"):76===i?this.shortcuts(e,"superscript"):72===i&&this.shortcuts(e,"subscript")),s||90===i||(this.opts.buffer=!1),!0===a&&13===i){e.preventDefault();var n=t(r).parent().text();return this.insertNodeAtCaret(this.document.createTextNode("\r\n")),-1==n.search(/\s$/)&&this.insertNodeAtCaret(this.document.createTextNode("\r\n")),this.syncCode(),!1}if(this.opts.shortcuts&&!e.shiftKey&&9===i){if(!1!==a)return e.preventDefault(),this.insertNodeAtCaret(this.document.createTextNode("\t")),this.syncCode(),!1;this.shortcuts(e,"indent")}else this.opts.shortcuts&&e.shiftKey&&9===i&&this.shortcuts(e,"outdent");if(this.browser("webkit")&&-1===navigator.userAgent.indexOf("Chrome"))return this.safariShiftKeyEnter(e,i)},this))},build:function(e,i){if(!0!==e){if(this.$box=t('<div class="redactor_box"></div>'),this.opts.air&&(this.air=t('<div class="redactor_air" style="display: none;"></div>')),this.$content=null,this.textareamode=!0,"TEXTAREA"===this.$el.get(0).tagName){if(this.opts.iframe){var o=this;this.$content=t('<iframe style="width: 100%;" frameborder="0"></iframe>').load(function(){(function(){this.$editor=this.$content.contents().find("body").attr("contenteditable",!0).attr("dir",this.opts.direction),rdocument=this.document=this.$editor[0].ownerDocument,rwindow=this.window=this.document.defaultView||window,!1!==this.opts.css&&this.$content.contents().find("head").append('<link rel="stylesheet" href="'+this.opts.css+'" />'),this.$editor.html(a),i&&(i.call(this),i=null)}).call(o)})}else this.$content=this.$editor=t("<div></div>");var r=this.$el.get(0).className.split(/\s+/);t.each(r,t.proxy(function(t,e){this.$content.addClass("redactor_"+e)},this))}else this.textareamode=!1,this.$content=this.$editor=this.$el,this.$el=t('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height);this.$editor&&this.$editor.addClass("redactor_editor").attr("contenteditable",!0).attr("dir",this.opts.direction),!1!==this.opts.tabindex&&this.$content.attr("tabindex",this.opts.tabindex),!1!==this.opts.minHeight&&this.$content.css("min-height",this.opts.minHeight+"px"),!0===this.opts.wym&&this.$content.addClass("redactor_editor_wym"),!1===this.opts.autoresize&&this.$content.css("height",this.height),this.$el.hide();var a="";this.textareamode?(a=this.$el.val(),a=this.savePreCode(a),this.$box.insertAfter(this.$el).append(this.$content).append(this.$el)):(a=this.$editor.html(),a=this.savePreCode(a),this.$box.insertAfter(this.$content).append(this.$el).append(this.$editor)),a=this.paragraphy(a),this.$editor&&this.$editor.html(a),!1===this.textareamode&&this.syncCode()}else if("TEXTAREA"!==this.$el.get(0).tagName){a=this.$el.val();var s=t('<textarea name="'+this.$editor.attr("id")+'"></textarea>').css("height",this.height).val(a);this.$el.hide(),this.$el.after(s)}i&&this.$editor&&i.call(this)},enableAir:function(){if(!1===this.opts.air)return!1;this.air.hide(),this.$editor.bind("textselect",t.proxy(function(t){this.showAir(t)},this)),this.$editor.bind("textunselect",t.proxy(function(){this.air.hide()},this))},showAir:function(e){t(".redactor_air").hide();var i=this.air.innerWidth(),o=e.clientX;t(this.document).width()<o+i&&(o-=i);var r=e.clientY+t(document).scrollTop()+14;!0===this.opts.iframe&&(r+=this.$box.position().top,o+=this.$box.position().left),this.air.css({left:o+"px",top:r+"px"}).show()},syncCode:function(){this.$el.val(this.$editor.html())},setCode:function(t){t=this.stripTags(t),this.$editor.html(t).focus(),this.syncCode()},getCode:function(){var t="";return t=this.opts.visual?this.$editor.html():this.$el.val(),this.stripTags(t)},insertHtml:function(t){this.$editor.focus(),this.pasteHtmlAtCaret(t),this.observeImages(),this.syncCode()},pasteHtmlAtCaret:function(t){var e,i;if(this.document.getSelection){if((e=this.window.getSelection()).getRangeAt&&e.rangeCount){(i=e.getRangeAt(0)).deleteContents();var o=this.document.createElement("div");o.innerHTML=t;for(var r,a,s=this.document.createDocumentFragment();r=o.firstChild;)a=s.appendChild(r);i.insertNode(s),a&&((i=i.cloneRange()).setStartAfter(a),i.collapse(!0),e.removeAllRanges(),e.addRange(i))}}else this.document.selection&&"Control"!=this.document.selection.type&&this.document.selection.createRange().pasteHTML(t)},destroy:function(){var e=this.getCode();this.textareamode?(this.$box.after(this.$el),this.$box.remove(),this.$el.height(this.height).val(e).show()):(this.$box.after(this.$editor),this.$box.remove(),this.$editor.removeClass("redactor_editor").removeClass("redactor_editor_wym").attr("contenteditable",!1).html(e).show()),this.opts.toolbarExternal&&t(this.opts.toolbarExternal).empty(),t(".redactor_air").remove();for(var i=0;i<this.dropdowns.length;i++)this.dropdowns[i].remove(),delete this.dropdowns[i];!1!==this.opts.autosave&&clearInterval(this.autosaveInterval)},observeFormatting:function(){var e=this.getCurrentNode();this.inactiveAllButtons(),t.each(this.opts.activeButtonsStates,t.proxy(function(i,o){0!=t(e).closest(i,this.$editor.get()[0]).length&&this.setBtnActive(o)},this));var i=t(e).closest(["p","div","h1","h2","h3","h4","h5","h6","blockquote","td"]);if(void 0!==i[0]&&void 0!==i[0].elem&&0!=t(i[0].elem).size())switch(t(i[0].elem).css("text-align")){case"right":this.setBtnActive("alignright");break;case"center":this.setBtnActive("aligncenter");break;case"justify":this.setBtnActive("justify");break;default:this.setBtnActive("alignleft")}},observeImages:function(){if(!1===this.opts.observeImages)return!1;this.$editor.find("img").each(t.proxy(function(e,i){this.browser("msie")&&t(i).attr("unselectable","on"),this.resizeImage(i)},this))},observeTables:function(){this.$editor.find("table").click(t.proxy(this.tableObserver,this))},observeScroll:function(){var e=0;if(t(this.document).scrollTop()>this.$box.offset().top){var i="100%";this.opts.fixedBox&&(e=this.$box.offset().left,i=this.$box.innerWidth()),this.fixed=!0,this.$toolbar.css({position:"fixed",width:i,zIndex:1005,top:this.opts.fixedTop+"px",left:e})}else this.fixed=!1,this.$toolbar.css({position:"relative",width:"auto",zIndex:1,top:0,left:e})},setBuffer:function(){this.saveSelection(),this.opts.buffer=this.$editor.html()},getBuffer:function(){if(!1===this.opts.buffer)return!1;this.$editor.html(this.opts.buffer),this.browser("msie")||this.restoreSelection(),this.opts.buffer=!1},execCommand:function(e,i){if(0==this.opts.visual)return this.$el.focus(),!1;try{var o;if("inserthtml"===e)this.browser("msie")?(this.$editor.focus(),this.document.selection.createRange().pasteHTML(i)):this.pasteHtmlAtCaret(i),this.observeImages();else if("unlink"===e)o=this.getParentNode(),"A"===t(o).get(0).tagName?t(o).replaceWith(t(o).text()):this.execRun(e,i);else if("JustifyLeft"===e||"JustifyCenter"===e||"JustifyRight"===e||"JustifyFull"===e){o=this.getCurrentNode();var r=t(o).get(0).tagName;if(!1===this.opts.iframe&&0==t(o).parents(".redactor_editor").size())return!1;if(-1!=t.inArray(r,["P","DIV","H1","H2","H3","H4","H5","H6","BLOCKQUOTE","TD"])){var a=!1;"JustifyCenter"===e?a="center":"JustifyRight"===e?a="right":"JustifyFull"===e&&(a="justify"),!1===a?t(o).css("text-align",""):t(o).css("text-align",a)}else this.execRun(e,i)}else if("formatblock"===e&&"blockquote"===i)if(o=this.getCurrentNode(),"BLOCKQUOTE"===t(o).get(0).tagName)if(this.browser("msie")){var s=t("<p>"+t(o).html()+"</p>");t(o).replaceWith(s)}else this.execRun(e,"p");else if("P"===t(o).get(0).tagName){var n=t(o).parent();if("BLOCKQUOTE"===t(n).get(0).tagName){s=t("<p>"+t(o).html()+"</p>");t(n).replaceWith(s),this.setSelection(s[0],0,s[0],0)}else if(this.browser("msie")){s=t("<blockquote>"+t(o).html()+"</blockquote>");t(o).replaceWith(s)}else this.execRun(e,i)}else this.execRun(e,i);else"formatblock"!==e||"pre"!==i&&"p"!==i?("inserthorizontalrule"===e&&this.browser("msie")&&this.$editor.focus(),"formatblock"===e&&this.browser("mozilla")&&this.$editor.focus(),this.execRun(e,i)):(o=this.getParentNode(),"PRE"===t(o).get(0).tagName?t(o).replaceWith("<p>"+this.encodeEntities(t(o).text())+"</p>"):this.execRun(e,i));"inserthorizontalrule"===e&&this.$editor.find("hr").removeAttr("id"),this.syncCode(),this.oldIE()&&this.$editor.focus(),"function"==typeof this.opts.execCommandCallback&&this.opts.execCommandCallback(this,e),this.opts.air&&this.air.hide()}catch(t){}},execRun:function(t,e){"formatblock"===t&&this.browser("msie")&&(e="<"+e+">"),this.document.execCommand(t,!1,e)},formatNewLine:function(e){var i=this.getParentNode();if("DIV"===i.nodeName&&"redactor_editor"===i.className){var o=t(this.getCurrentNode());if("DIV"===o.get(0).tagName&&(""===o.html()||"<br>"===o.html())){var r=t("<p>").append(o.clone().get(0).childNodes);o.replaceWith(r),r.html("<br />"),this.setSelection(r[0],0,r[0],0)}}},safariShiftKeyEnter:function(e,i){return!e.shiftKey||13!==i||(e.preventDefault(),this.insertNodeAtCaret(t("<span><br /></span>").get(0)),this.syncCode(),!1)},formatEmpty:function(e){var i=t.trim(this.$editor.html());this.browser("mozilla")&&(i=i.replace(/<br>/i,""));var o=i.replace(/<(?:.|\n)*?>/gm,"");if(""===i||""===o){e.preventDefault();var r=t(this.opts.emptyHtml).get(0);return this.$editor.html(r),this.setSelection(r,0,r,0),this.syncCode(),!1}this.syncCode()},paragraphy:function(e){if(""===(e=t.trim(e))||"<p></p>"===e)return this.opts.emptyHtml;this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>"));var i=function(t,e,i){return t.replace(new RegExp(e,"g"),i)},o=function(t,o){return i(e,t,o)},r="(table|thead|tfoot|caption|colgroup|tbody|tr|td|th|div|dl|dd|dt|ul|ol|li|pre|select|form|blockquote|address|math|style|script|object|input|param|p|h[1-6])";return e+="\n",o("<br />\\s*<br />","\n\n"),o("(<"+r+"[^>]*>)","\n$1"),o("(</"+r+">)","$1\n\n"),o("\r\n|\r","\n"),o("\n\n+","\n\n"),o("\n?((.|\n)+?)$","<p>$1</p>\n"),o("<p>\\s*?</p>",""),o("<p>(<div[^>]*>\\s*)","$1<p>"),o("<p>([^<]+)\\s*?(</(div|address|form)[^>]*>)","<p>$1</p>$2"),o("<p>\\s*(</?"+r+"[^>]*>)\\s*</p>","$1"),o("<p>(<li.+?)</p>","$1"),o("<p>\\s*(</?"+r+"[^>]*>)","$1"),o("(</?"+r+"[^>]*>)\\s*</p>","$1"),o("(</?"+r+"[^>]*>)\\s*<br />","$1"),o("<br />(\\s*</?(p|li|div|dl|dd|dt|th|pre|td|ul|ol)[^>]*>)","$1"),-1!=e.indexOf("<pre")&&o("(<pre(.|\n)*?>)((.|\n)*?)</pre>",function(t,e,o,r){return i(e,"\\\\(['\"\\\\])","$1")+i(i(i(r,"<p>","\n"),"</p>|<br />",""),"\\\\(['\"\\\\])","$1")+"</pre>"}),o("\n</p>$","</p>")},stripTags:function(e){var i=this.opts.allowedTags;return e.replace(/<\/?([a-z][a-z0-9]*)\b[^>]*>/gi,function(e,o){return t.inArray(o.toLowerCase(),i)>"-1"?e:""})},savePreCode:function(e){var i=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==i&&t.each(i,t.proxy(function(t,i){var o=i.match(/<pre(.*?)>([\w\W]*?)<\/pre>/i);o[2]=this.encodeEntities(o[2]),e=e.replace(i,"<pre"+o[1]+">"+o[2]+"</pre>")},this)),e},encodeEntities:function(t){return t=String(t).replace(/&amp;/g,"&").replace(/&lt;/g,"<").replace(/&gt;/g,">").replace(/&quot;/g,'"'),String(t).replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;")},cleanupPre:function(t){t=(t=(t=t.replace(/<br>/gi,"\n")).replace(/<\/p>/gi,"\n")).replace(/<\/div>/gi,"\n");var e=this.document.createElement("div");return e.innerHTML=t,e.textContent||e.innerText},pasteCleanUp:function(e){var i=this.getParentNode();if("PRE"===t(i).get(0).tagName)return e=this.cleanupPre(e),this.pasteCleanUpInsert(e),!0;e=(e=(e=e.replace(/<!--[\s\S]*?-->|<\?(?:php)?[\s\S]*?\?>/gi,"")).replace(/(&nbsp;){2,}/gi,"&nbsp;")).replace(/<b\sid="internal-source-marker(.*?)">([\w\W]*?)<\/b>/gi,"$2"),e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=(e=this.stripTags(e)).replace(/<td><\/td>/gi,"[td]")).replace(/<td>&nbsp;<\/td>/gi,"[td]")).replace(/<td><br><\/td>/gi,"[td]")).replace(/<a(.*?)href="(.*?)"(.*?)>([\w\W]*?)<\/a>/gi,'[a href="$2"]$4[/a]')).replace(/<iframe(.*?)>([\w\W]*?)<\/iframe>/gi,"[iframe$1]$2[/iframe]")).replace(/<video(.*?)>([\w\W]*?)<\/video>/gi,"[video$1]$2[/video]")).replace(/<audio(.*?)>([\w\W]*?)<\/audio>/gi,"[audio$1]$2[/audio]")).replace(/<embed(.*?)>([\w\W]*?)<\/embed>/gi,"[embed$1]$2[/embed]")).replace(/<object(.*?)>([\w\W]*?)<\/object>/gi,"[object$1]$2[/object]")).replace(/<param(.*?)>/gi,"[param$1]")).replace(/<img(.*?)style="(.*?)"(.*?)>/gi,"[img$1$3]")).replace(/<(\w+)([\w\W]*?)>/gi,"<$1>")).replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"")).replace(/<[^\/>][^>]*>(\s*|\t*|\n*|&nbsp;|<br>)<\/[^>]+>/gi,"")).replace(/\[td\]/gi,"<td>&nbsp;</td>")).replace(/\[a href="(.*?)"\]([\w\W]*?)\[\/a\]/gi,'<a href="$1">$2</a>')).replace(/\[iframe(.*?)\]([\w\W]*?)\[\/iframe\]/gi,"<iframe$1>$2</iframe>")).replace(/\[video(.*?)\]([\w\W]*?)\[\/video\]/gi,"<video$1>$2</video>")).replace(/\[audio(.*?)\]([\w\W]*?)\[\/audio\]/gi,"<audio$1>$2</audio>")).replace(/\[embed(.*?)\]([\w\W]*?)\[\/embed\]/gi,"<embed$1>$2</embed>")).replace(/\[object(.*?)\]([\w\W]*?)\[\/object\]/gi,"<object$1>$2</object>")).replace(/\[param(.*?)\]/gi,"<param$1>")).replace(/\[img(.*?)\]/gi,"<img$1>"),this.opts.convertDivs&&(e=e.replace(/<div(.*?)>([\w\W]*?)<\/div>/gi,"<p>$2</p>")),e=(e=(e=(e=e.replace(/<span>([\w\W]*?)<\/span>/gi,"$1")).replace(/\n{3,}/gi,"\n")).replace(/<p><p>/gi,"<p>")).replace(/<\/p><\/p>/gi,"</p>"),this.browser("mozilla")&&(e=e.replace(/<br>$/gi,"")),this.pasteCleanUpInsert(e)},pasteCleanUpInsert:function(e){this.execCommand("inserthtml",e),!0===this.opts.autoresize?t(this.document.body).scrollTop(this.saveScroll):this.$editor.scrollTop(this.saveScroll)},formattingRemove:function(e){var i=[],o=e.match(/<pre(.*?)>([\w\W]*?)<\/pre>/gi);return null!==o&&t.each(o,function(t,o){e=e.replace(o,"prebuffer_"+t),i.push(o)}),e=(e=(e=(e=(e=(e=(e=e.replace(/\s{2,}/g," ")).replace(/\n/g," ")).replace(/[\t]*/g,"")).replace(/\n\s*\n/g,"\n")).replace(/^[\s\n]*/g,"")).replace(/[\s\n]*$/g,"")).replace(/>\s+</g,"><"),i&&(t.each(i,function(t,i){e=e.replace("prebuffer_"+t,i)}),i=[]),e},formattingIndenting:function(t){return t=(t=(t=(t=t.replace(/<li/g,"\t<li")).replace(/<tr/g,"\t<tr")).replace(/<td/g,"\t\t<td")).replace(/<\/tr>/g,"\t</tr>")},formattingEmptyTags:function(t){for(var e=["<pre></pre>","<blockquote>\\s*</blockquote>","<em>\\s*</em>","<ul></ul>","<ol></ol>","<li></li>","<table></table>","<tr></tr>","<span>\\s*<span>","<span>&nbsp;<span>","<b>\\s*</b>","<b>&nbsp;</b>","<p>\\s*</p>","<p>&nbsp;</p>","<p>\\s*<br>\\s*</p>","<div>\\s*</div>","<div>\\s*<br>\\s*</div>"],i=0;i<e.length;++i){var o=e[i];t=t.replace(new RegExp(o,"gi"),"")}return t},formattingAddBefore:function(t){for(var e=["<p","<form","</ul>","</ol>","<fieldset","<legend","<object","<embed","<select","<option","<input","<textarea","<pre","<blockquote","<ul","<ol","<li","<dl","<dt","<dd","<table","<thead","<tbody","<caption","</caption>","<th","<tr","<td","<figure"],i=0;i<e.length;++i){var o=e[i];t=t.replace(new RegExp(o,"gi"),"\r\n"+o)}return t},formattingAddAfter:function(t){for(var e=["</p>","</div>","</h1>","</h2>","</h3>","</h4>","</h5>","</h6>","<br>","<br />","</dl>","</dt>","</dd>","</form>","</blockquote>","</pre>","</legend>","</fieldset>","</object>","</embed>","</textarea>","</select>","</option>","</table>","</thead>","</tbody>","</tr>","</td>","</th>","</figure>"],i=0;i<e.length;++i){var o=e[i];t=t.replace(new RegExp(o,"gi"),o+"\r\n")}return t},formatting:function(t){return t=this.formattingRemove(t),t=this.formattingEmptyTags(t),t=this.formattingAddBefore(t),t=this.formattingAddAfter(t),t=this.formattingIndenting(t)},toggle:function(){if(this.opts.visual){var t=this.$editor.innerHeight();this.$editor.hide(),this.$content.hide(),e=this.$editor.html(),this.$el.height(t).val(e).show().focus(),this.setBtnActive("html"),this.opts.visual=!1}else{this.$el.hide();var e=this.$el.val();this.$editor.html(e).show(),this.$content.show(),""===this.$editor.html()&&this.setCode(this.opts.emptyHtml),this.$editor.focus(),this.setBtnInactive("html"),this.opts.visual=!0,this.observeImages(),this.observeTables()}},autoSave:function(){this.autosaveInterval=setInterval(t.proxy(function(){t.ajax({url:this.opts.autosave,type:"post",data:this.$el.attr("name")+"="+escape(encodeURIComponent(this.getCode())),success:t.proxy(function(t){"function"==typeof this.opts.autosaveCallback&&this.opts.autosaveCallback(t,this)},this)})},this),1e3*this.opts.interval)},buildToolbar:function(){if(!1===this.opts.toolbar)return!1;this.$toolbar=t("<ul>").addClass("redactor_toolbar"),this.opts.air?(t(this.air).append(this.$toolbar),t("body").append(this.air)):!1===this.opts.toolbarExternal?this.$box.prepend(this.$toolbar):t(this.opts.toolbarExternal).html(this.$toolbar),t.each(this.opts.buttons,t.proxy(function(e,i){if("|"!==i&&void 0!==this.opts.toolbar[i]){var o=this.opts.toolbar[i];if(!1===this.opts.fileUpload&&"file"===i)return!0;this.$toolbar.append(t("<li>").append(this.buildButton(i,o)))}"|"===i&&this.$toolbar.append(t('<li class="redactor_separator"></li>'))},this))},buildButton:function(e,i){var o=t('<a href="javascript:void(null);" title="'+i.title+'" class="redactor_btn_'+e+'"></a>');if(void 0===i.func?o.click(t.proxy(function(){-1!=t.inArray(e,this.opts.activeButtons)&&(this.inactiveAllButtons(),this.setBtnActive(e)),this.browser("mozilla")&&this.$editor.focus(),this.execCommand(i.exec,e)},this)):"show"!==i.func&&o.click(t.proxy(function(t){this[i.func](t)},this)),void 0!==i.callback&&!1!==i.callback&&o.click(t.proxy(function(t){i.callback(this,t,e)},this)),"backcolor"===e||"fontcolor"===e||void 0!==i.dropdown){var r=t('<div class="redactor_dropdown" style="display: none;">');r="backcolor"===e||"fontcolor"===e?this.buildColorPicker(r,e):this.buildDropdown(r,i.dropdown),this.dropdowns.push(r.appendTo(t(document.body))),this.hdlShowDropDown=t.proxy(function(t){this.showDropDown(t,r,e)},this),o.click(this.hdlShowDropDown)}return o},buildDropdown:function(e,i){return t.each(i,t.proxy(function(i,o){var r;void 0===o.className&&(o.className=""),void 0!==o.name&&"separator"===o.name?r=t('<a class="redactor_separator_drop">'):(r=t('<a href="javascript:void(null);" class="'+o.className+'">'+o.title+"</a>"),"function"==typeof o.callback?t(r).click(t.proxy(function(t){o.callback(this,t,i)},this)):void 0===o.func?t(r).click(t.proxy(function(){this.execCommand(o.exec,i)},this)):t(r).click(t.proxy(function(t){this[o.func](t)},this))),t(e).append(r)},this)),e},buildColorPicker:function(e,i){var o;o="backcolor"===i?this.browser("msie")?"BackColor":"hilitecolor":"forecolor",t(e).width(210);for(var r=this.opts.colors.length,a=0;a<r;++a){var s=this.opts.colors[a],n=t('<a rel="'+s+'" href="javascript:void(null);" class="redactor_color_link"></a>').css({backgroundColor:s});t(e).append(n);var l=this;t(n).click(function(){l.execCommand(o,t(this).attr("rel")),"forecolor"===o&&l.$editor.find("font").replaceWith(function(){return t('<span style="color: '+t(this).attr("color")+';">'+t(this).html()+"</span>")}),l.browser("msie")&&"BackColor"===o&&l.$editor.find("font").replaceWith(function(){return t('<span style="'+t(this).attr("style")+'">'+t(this).html()+"</span>")})})}var d=t('<a href="javascript:void(null);" class="redactor_color_none"></a>').html(RLANG.none);return"backcolor"===i?d.click(t.proxy(this.setBackgroundNone,this)):d.click(t.proxy(this.setColorNone,this)),t(e).append(d),e},setBackgroundNone:function(){t(this.getParentNode()).css("background-color","transparent"),this.syncCode()},setColorNone:function(){t(this.getParentNode()).attr("color","").css("color",""),this.syncCode()},showDropDown:function(e,i,o){if(this.getBtn(o).hasClass("dropact"))this.hideAllDropDown();else{this.hideAllDropDown(),this.setBtnActive(o),this.getBtn(o).addClass("dropact");var r=this.getBtn(o).offset().left;if(this.opts.air){var a=this.air.offset().top;t(i).css({position:"absolute",left:r+"px",top:a+30+"px"}).show()}else if(this.opts.fixed&&this.fixed)t(i).css({position:"fixed",left:r+"px",top:"30px"}).show();else{var s=this.$toolbar.offset().top+30;t(i).css({position:"absolute",left:r+"px",top:s+"px"}).show()}}var n=t.proxy(function(t){this.hideDropDown(t,i,o)},this);t(document).one("click",n),this.$editor.one("click",n),this.$content.one("click",n),e.stopPropagation()},hideAllDropDown:function(){this.$toolbar.find("a.dropact").removeClass("redactor_act").removeClass("dropact"),t(".redactor_dropdown").hide()},hideDropDown:function(e,i,o){t(e.target).hasClass("dropact")||(t(i).removeClass("dropact"),this.showedDropDown=!1,this.hideAllDropDown())},getBtn:function(e){return!1!==this.opts.toolbar&&t(this.$toolbar.find("a.redactor_btn_"+e))},setBtnActive:function(t){this.getBtn(t).addClass("redactor_act")},setBtnInactive:function(t){this.getBtn(t).removeClass("redactor_act")},inactiveAllButtons:function(){t.each(this.opts.activeButtons,t.proxy(function(t,e){this.setBtnInactive(e)},this))},changeBtnIcon:function(t,e){this.getBtn(t).addClass("redactor_btn_"+e)},removeBtnIcon:function(t,e){this.getBtn(t).removeClass("redactor_btn_"+e)},addBtnSeparator:function(){this.$toolbar.append(t('<li class="redactor_separator"></li>'))},addBtnSeparatorAfter:function(e){this.getBtn(e).parent().after(t('<li class="redactor_separator"></li>'))},addBtnSeparatorBefore:function(e){this.getBtn(e).parent().before(t('<li class="redactor_separator"></li>'))},removeBtnSeparatorAfter:function(t){this.getBtn(t).parent().next().remove()},removeBtnSeparatorBefore:function(t){this.getBtn(t).parent().prev().remove()},setBtnRight:function(t){if(!1===this.opts.toolbar)return!1;this.getBtn(t).parent().addClass("redactor_btn_right")},setBtnLeft:function(t){if(!1===this.opts.toolbar)return!1;this.getBtn(t).parent().removeClass("redactor_btn_right")},addBtn:function(e,i,o,r){if(!1===this.opts.toolbar)return!1;var a=this.buildButton(e,{title:i,callback:o,dropdown:r});this.$toolbar.append(t("<li>").append(a))},addBtnFirst:function(e,i,o,r){if(!1===this.opts.toolbar)return!1;var a=this.buildButton(e,{title:i,callback:o,dropdown:r});this.$toolbar.prepend(t("<li>").append(a))},addBtnAfter:function(e,i,o,r,a){if(!1===this.opts.toolbar)return!1;var s=this.buildButton(i,{title:o,callback:r,dropdown:a});this.getBtn(e).parent().after(t("<li>").append(s))},addBtnBefore:function(e,i,o,r,a){if(!1===this.opts.toolbar)return!1;var s=this.buildButton(i,{title:o,callback:r,dropdown:a});this.getBtn(e).parent().before(t("<li>").append(s))},removeBtn:function(t,e){var i=this.getBtn(t);!0===e&&i.parent().next().remove(),i.parent().removeClass("redactor_btn_right"),i.remove()},getFragmentHtml:function(t){var e=t.cloneNode(!0),i=this.document.createElement("div");return i.appendChild(e),i.innerHTML},extractContent:function(){for(var t,e=this.$editor.get(0),i=this.document.createDocumentFragment();t=e.firstChild;)i.appendChild(t);return i},saveSelection:function(){this.$editor.focus(),this.savedSel=this.getOrigin(),this.savedSelObj=this.getFocus()},restoreSelection:function(){void 0!==this.savedSel&&null!==this.savedSel&&null!==this.savedSelObj&&"BODY"!==this.savedSel[0].tagName?!1===this.opts.iframe&&0==t(this.savedSel[0]).closest(".redactor_editor").length?this.$editor.focus():(this.browser("opera")&&this.$editor.focus(),this.setSelection(this.savedSel[0],this.savedSel[1],this.savedSelObj[0],this.savedSelObj[1]),this.browser("mozilla")&&this.$editor.focus()):this.$editor.focus()},getSelection:function(){var t=this.document;return this.window.getSelection?this.window.getSelection():t.getSelection?t.getSelection():t.selection.createRange()},hasSelection:function(){if(this.oldIE()){var t,e=this.$editor.get(0);return e.focus(),e.document.selection?(t=e.document.selection.createRange())&&t.parentElement().document===e.document:!1}var i;return(i=this.getSelection())&&null!=i.focusNode&&null!=i.anchorNode},getOrigin:function(){if(this.oldIE()){var t,e=this.$editor.get(0);return e.focus(),this.hasSelection()?(t=e.document.selection.createRange(),this._getBoundary(e.document,t,!0)):null}var i;return(i=this.getSelection())&&null!=i.anchorNode?[i.anchorNode,i.anchorOffset]:null},getFocus:function(){if(this.oldIE()){var t,e=this.$editor.get(0);return e.focus(),this.hasSelection()?(t=e.document.selection.createRange(),this._getBoundary(e.document,t,!1)):null}var i;return(i=this.getSelection())&&null!=i.focusNode?[i.focusNode,i.focusOffset]:null},setSelection:function(t,e,i,o){if(null==i&&(i=t),null==o&&(o=e),this.oldIE()){var a=this.$editor.get(0),s=a.document.body.createTextRange();return this._moveBoundary(a.document,s,!1,i,o),this._moveBoundary(a.document,s,!0,t,e),s.select()}var n=this.getSelection();if(n)if(n.collapse&&n.extend)n.collapse(t,e),n.extend(i,o);else{r=this.document.createRange(),r.setStart(t,e),r.setEnd(i,o);try{n.removeAllRanges()}catch(t){}n.addRange(r)}},getCurrentNode:function(){return void 0!==this.window.getSelection?this.getSelectedNode().parentNode:void 0!==this.document.selection?this.getSelection().parentElement():void 0},getParentNode:function(){return t(this.getCurrentNode()).parent()[0]},getSelectedNode:function(){return this.oldIE()?this.getSelection().parentElement():void 0!==this.window.getSelection?this.window.getSelection().rangeCount>0&&this.getSelection().getRangeAt(0).commonAncestorContainer:void 0!==this.document.selection?this.getSelection():void 0},_getBoundary:function(t,e,i){var o,r,a,s,n;for(r=t.createElement("a"),(o=e.duplicate()).collapse(i),n=o.parentElement();n.insertBefore(r,r.previousSibling),o.moveToElementText(r),o.compareEndPoints(i?"StartToStart":"StartToEnd",e)>0&&null!=r.previousSibling;);return-1===o.compareEndPoints(i?"StartToStart":"StartToEnd",e)&&r.nextSibling?(o.setEndPoint(i?"EndToStart":"EndToEnd",e),a=r.nextSibling,s=o.text.length):(a=r.parentNode,s=this._getChildIndex(r)),r.parentNode.removeChild(r),[a,s]},_moveBoundary:function(t,e,i,o,r){var a,s,n,l,d;return d=0,a=this._isText(o)?o:o.childNodes[r],s=this._isText(o)?o.parentNode:o,this._isText(o)&&(d=r),l=t.createElement("a"),s.insertBefore(l,a||null),(n=t.body.createTextRange()).moveToElementText(l),l.parentNode.removeChild(l),e.setEndPoint(i?"StartToStart":"EndToEnd",n),e[i?"moveStart":"moveEnd"]("character",d)},_isText:function(t){return null!=t&&3==t.nodeType},_getChildIndex:function(t){for(var e=0;t=t.previousSibling;)e++;return e},insertNodeAfterCaret:function(t){this.saveSelection(),this.insertNodeAtCaret(t),this.restoreSelection()},insertNodeAtCaret:function(t){if(this.window.getSelection){var e=this.getSelection();if(e.rangeCount){var i=e.getRangeAt(0);i.collapse(!1),i.insertNode(t),(i=i.cloneRange()).selectNodeContents(t),i.collapse(!1),e.removeAllRanges(),e.addRange(i)}}else if(this.document.selection){var o=1===t.nodeType?t.outerHTML:t.data,r="marker_"+(""+Math.random()).slice(2);o+='<span id="'+r+'"></span>';var a=this.getSelection();a.collapse(!1),a.pasteHTML(o);var s=this.document.getElementById(r);a.moveToElementText(s),a.select(),s.parentNode.removeChild(s)}},getSelectedHtml:function(){var t="";if(this.window.getSelection){var e=this.window.getSelection();if(e.rangeCount){for(var i=this.document.createElement("div"),o=0,r=e.rangeCount;o<r;++o)i.appendChild(e.getRangeAt(o).cloneContents());t=i.innerHTML}}else this.document.selection&&"Text"===this.document.selection.type&&(t=this.document.selection.createRange().htmlText);return t},resizeImage:function(e){var i,o=!1,r=!1,a=t(e).width()/t(e).height();t(e).off("hover mousedown mouseup click mousemove"),t(e).hover(function(){t(e).css("cursor","nw-resize")},function(){t(e).css("cursor",""),o=!1}),t(e).mousedown(function(s){s.preventDefault(),a=t(e).width()/t(e).height(),o=!0,r=!0,Math.round(s.pageX-t(e).eq(0).offset().left),i=Math.round(s.pageY-t(e).eq(0).offset().top)}),t(e).mouseup(t.proxy(function(i){o=!1,t(e).css("cursor",""),this.syncCode()},this)),t(e).click(t.proxy(function(t){r&&this.imageEdit(t)},this)),t(e).mousemove(function(s){if(o){r=!1;Math.round(s.pageX-t(this).eq(0).offset().left);var n=Math.round(s.pageY-t(this).eq(0).offset().top)-i,l=t(e).height(),d=parseInt(l,10)+n,c=d*a;c>10&&t(e).width(c),d>10&&t(e).height(d),Math.round(s.pageX-t(this).eq(0).offset().left),i=Math.round(s.pageY-t(this).eq(0).offset().top)}})},showTable:function(){this.saveSelection(),this.modalInit(RLANG.table,this.opts.modal_table,300,t.proxy(function(){t("#redactor_insert_table_btn").click(t.proxy(this.insertTable,this)),setTimeout(function(){t("#redactor_table_rows").focus()},200)},this))},insertTable:function(){for(var e=t("#redactor_table_rows").val(),i=t("#redactor_table_columns").val(),o=t("<div></div>"),r=Math.floor(99999*Math.random()),a=t('<table id="table'+r+'"><tbody></tbody></table>'),s=0;s<e;s++){for(var n=t("<tr></tr>"),l=0;l<i;l++){var d=t("<td><br></td>");t(n).append(d)}t(a).append(n)}t(o).append(a);var c=t(o).html()+"<p></p>";this.restoreSelection(),this.execCommand("inserthtml",c),this.modalClose(),this.observeTables()},tableObserver:function(e){this.$table=t(e.target).closest("table"),this.$table_tr=this.$table.find("tr"),this.$table_td=this.$table.find("td"),this.$tbody=t(e.target).closest("tbody"),this.$thead=t(this.$table).find("thead"),this.$current_td=t(e.target),this.$current_tr=t(e.target).closest("tr")},deleteTable:function(){t(this.$table).remove(),this.$table=!1,this.syncCode()},deleteRow:function(){t(this.$current_tr).remove(),this.syncCode()},deleteColumn:function(){var e=t(this.$current_td).get(0).cellIndex;t(this.$table).find("tr").each(function(){t(this).find("td").eq(e).remove()}),this.syncCode()},addHead:function(){if(0!==t(this.$table).find("thead").size())this.deleteHead();else{var e=t(this.$table).find("tr").first().clone();e.find("td").html("&nbsp;"),this.$thead=t("<thead></thead>"),this.$thead.append(e),t(this.$table).prepend(this.$thead),this.syncCode()}},deleteHead:function(){t(this.$thead).remove(),this.$thead=!1,this.syncCode()},insertRowAbove:function(){this.insertRow("before")},insertRowBelow:function(){this.insertRow("after")},insertColumnLeft:function(){this.insertColumn("before")},insertColumnRight:function(){this.insertColumn("after")},insertRow:function(e){var i=t(this.$current_tr).clone();i.find("td").html("&nbsp;"),"after"===e?t(this.$current_tr).after(i):t(this.$current_tr).before(i),this.syncCode()},insertColumn:function(e){var i=0;this.$current_tr.find("td").each(t.proxy(function(e,o){t(o)[0]===this.$current_td[0]&&(i=e)},this)),this.$table_tr.each(function(o,r){var a=t(r).find("td").eq(i),s=a.clone();s.html("&nbsp;"),"after"===e?t(a).after(s):t(a).before(s)}),this.syncCode()},showVideo:function(){this.saveSelection(),this.modalInit(RLANG.video,this.opts.modal_video,600,t.proxy(function(){t("#redactor_insert_video_btn").click(t.proxy(this.insertVideo,this)),setTimeout(function(){t("#redactor_insert_video_area").focus()},200)},this))},insertVideo:function(){var e=t("#redactor_insert_video_area").val();e=this.stripTags(e),this.restoreSelection(),this.execCommand("inserthtml",e),this.modalClose()},imageEdit:function(e){var i=t(e.target),o=i.parent(),r=t.proxy(function(){t("#redactor_file_alt").val(i.attr("alt")),t("#redactor_image_edit_src").attr("href",i.attr("src")),t("#redactor_form_image_align").val(i.css("float")),"A"===t(o).get(0).tagName&&t("#redactor_file_link").val(t(o).attr("href")),t("#redactor_image_delete_btn").click(t.proxy(function(){this.imageDelete(i)},this)),t("#redactorSaveBtn").click(t.proxy(function(){this.imageSave(i)},this))},this);this.modalInit(RLANG.image,this.opts.modal_image_edit,380,r)},imageDelete:function(e){t(e).remove(),this.modalClose(),this.syncCode()},imageSave:function(e){var i=t(e).parent();t(e).attr("alt",t("#redactor_file_alt").val());var o=t("#redactor_form_image_align").val();"left"===o?t(e).css({float:"left",margin:"0 10px 10px 0"}):"right"===o?t(e).css({float:"right",margin:"0 0 10px 10px"}):t(e).css({float:"none",margin:"0"});var r=t.trim(t("#redactor_file_link").val());""!==r?"A"!==t(i).get(0).tagName?t(e).replaceWith('<a href="'+r+'">'+this.outerHTML(e)+"</a>"):t(i).attr("href",r):"A"===t(i).get(0).tagName&&t(i).replaceWith(this.outerHTML(e)),this.modalClose(),this.observeImages(),this.syncCode()},showImage:function(){this.saveSelection();var e=t.proxy(function(){if(!1!==this.opts.imageGetJson?t.getJSON(this.opts.imageGetJson,t.proxy(function(e){var i={},o=0;t.each(e,t.proxy(function(t,e){void 0!==e.folder&&(o++,i[e.folder]=o)},this));var r=!1;if(t.each(e,t.proxy(function(e,o){var a="";void 0!==o.title&&(a=o.title);var s=0;t.isEmptyObject(i)||void 0===o.folder||(s=i[o.folder],!1===r&&(r=".redactorfolder"+s));var n=t('<img src="'+o.thumb+'" class="redactorfolder redactorfolder'+s+'" rel="'+o.image+'" title="'+a+'" />');t("#redactor_image_box").append(n),t(n).click(t.proxy(this.imageSetThumb,this))},this)),!t.isEmptyObject(i)){t(".redactorfolder").hide(),t(r).show();var a=t('<select id="redactor_image_box_select">');t.each(i,function(e,i){a.append(t('<option value="'+i+'">'+e+"</option>"))}),t("#redactor_image_box").before(a),a.change(function(e){t(".redactorfolder").hide(),t(".redactorfolder"+t(e.target).val()).show()})}},this)):t("#redactor_tabs a").eq(1).remove(),!1!==this.opts.imageUpload)!1===this.opts.uploadCrossDomain&&!1===this.isMobile()&&0!==t("#redactor_file").size()&&t("#redactor_file").dragupload({url:this.opts.imageUpload,uploadFields:this.opts.uploadFields,success:t.proxy(this.imageUploadCallback,this),error:t.proxy(this.opts.imageUploadErrorCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.imageUpload,success:t.proxy(this.imageUploadCallback,this),error:t.proxy(this.opts.imageUploadErrorCallback,this)});else if(t(".redactor_tab").hide(),!1===this.opts.imageGetJson)t("#redactor_tabs").remove(),t("#redactor_tab3").show();else{var e=t("#redactor_tabs a");e.eq(0).remove(),e.eq(1).addClass("redactor_tabs_act"),t("#redactor_tab2").show()}t("#redactor_upload_btn").click(t.proxy(this.imageUploadCallbackLink,this)),!1===this.opts.imageUpload&&!1===this.opts.imageGetJson&&setTimeout(function(){t("#redactor_file_link").focus()},200)},this);this.modalInit(RLANG.image,this.opts.modal_image,610,e)},imageSetThumb:function(e){this._imageSet('<img src="'+t(e.target).attr("rel")+'" alt="'+t(e.target).attr("title")+'" />',!0)},imageUploadCallbackLink:function(){if(""!==t("#redactor_file_link").val()){var e='<img src="'+t("#redactor_file_link").val()+'" />';this._imageSet(e,!0)}else this.modalClose()},imageUploadCallback:function(t){this._imageSet(t)},_imageSet:function(t,e){if(this.restoreSelection(),!1!==t){var i="";i=!0!==e?'<p><img src="'+t.filelink+'" /></p>':t,this.execCommand("inserthtml",i),!0!==e&&"function"==typeof this.opts.imageUploadCallback&&this.opts.imageUploadCallback(this,t)}this.modalClose(),this.observeImages()},showLink:function(){this.saveSelection();var e=t.proxy(function(){this.insert_link_node=!1;var e=this.getSelection(),i="",o="",r="";if(this.browser("msie")){var a=this.getParentNode();"A"===a.nodeName?(this.insert_link_node=t(a),o=this.insert_link_node.text(),i=this.insert_link_node.attr("href"),r=this.insert_link_node.attr("target")):o=this.oldIE()?e.text:e.toString()}else e&&e.anchorNode&&"A"===e.anchorNode.parentNode.tagName?(i=e.anchorNode.parentNode.href,o=e.anchorNode.parentNode.text,r=e.anchorNode.parentNode.target,""===e.toString()&&(this.insert_link_node=e.anchorNode.parentNode)):o=e.toString();t(".redactor_link_text").val(o);var s=self.location.href.replace(/\/$/i,""),n=i.replace(s,"");0===i.search("mailto:")?(this.setModalTab(2),t("#redactor_tab_selected").val(2),t("#redactor_link_mailto").val(i.replace("mailto:",""))):0===n.search(/^#/gi)?(this.setModalTab(3),t("#redactor_tab_selected").val(3),t("#redactor_link_anchor").val(n.replace(/^#/gi,""))):t("#redactor_link_url").val(n),"_blank"===r&&t("#redactor_link_blank").attr("checked",!0),t("#redactor_insert_link_btn").click(t.proxy(this.insertLink,this)),setTimeout(function(){t("#redactor_link_url").focus()},200)},this);this.modalInit(RLANG.link,this.opts.modal_link,460,e)},insertLink:function(){var e=t("#redactor_tab_selected").val(),i="",o="",r="";if("1"===e){i=t("#redactor_link_url").val(),o=t("#redactor_link_url_text").val(),t("#redactor_link_blank").attr("checked")&&(r=' target="_blank"');var a="/(w+:{0,1}w*@)?(S+)(:[0-9]+)?(/|/([w#!:.?+=&%@!-/]))?/",s=new RegExp("^(http|ftp|https)://"+a,"i"),n=new RegExp("^"+a,"i");-1==i.search(s)&&0==i.search(n)&&!1!==this.opts.protocol&&(i=this.opts.protocol+i)}else"2"===e?(i="mailto:"+t("#redactor_link_mailto").val(),o=t("#redactor_link_mailto_text").val()):"3"===e&&(i="#"+t("#redactor_link_anchor").val(),o=t("#redactor_link_anchor_text").val());this._insertLink('<a href="'+i+'"'+r+">"+o+"</a>",t.trim(o),i,r)},_insertLink:function(e,i,o,r){this.$editor.focus(),this.restoreSelection(),""!==i&&(this.insert_link_node?(t(this.insert_link_node).text(i),t(this.insert_link_node).attr("href",o),""!==r?t(this.insert_link_node).attr("target",r):t(this.insert_link_node).removeAttr("target"),this.syncCode()):this.execCommand("inserthtml",e)),this.modalClose()},showFile:function(){this.saveSelection();var e=t.proxy(function(){var e=this.getSelection(),i="";i=this.oldIE()?e.text:e.toString(),t("#redactor_filename").val(i),!1===this.opts.uploadCrossDomain&&!1===this.isMobile()&&t("#redactor_file").dragupload({url:this.opts.fileUpload,uploadFields:this.opts.uploadFields,success:t.proxy(this.fileUploadCallback,this),error:t.proxy(this.opts.fileUploadErrorCallback,this)}),this.uploadInit("redactor_file",{auto:!0,url:this.opts.fileUpload,success:t.proxy(this.fileUploadCallback,this),error:t.proxy(this.opts.fileUploadErrorCallback,this)})},this);this.modalInit(RLANG.file,this.opts.modal_file,500,e)},fileUploadCallback:function(e){if(this.restoreSelection(),!1!==e){var i=t("#redactor_filename").val();""===i&&(i=e.filename);var o='<a href="'+e.filelink+'">'+i+"</a>";this.browser("webkit")&&this.window.chrome&&(o+="&nbsp;"),this.execCommand("inserthtml",o),"function"==typeof this.opts.fileUploadCallback&&this.opts.fileUploadCallback(this,e)}this.modalClose()},modalInit:function(e,i,o,r){if(0===t("#redactor_modal_overlay").size()&&(this.overlay=t('<div id="redactor_modal_overlay" style="display: none;"></div>'),t("body").prepend(this.overlay)),this.opts.overlay&&(t("#redactor_modal_overlay").show(),t("#redactor_modal_overlay").click(t.proxy(this.modalClose,this))),0===t("#redactor_modal").size()&&(this.modal=t('<div id="redactor_modal" style="display: none;"><div id="redactor_modal_close">&times;</div><div id="redactor_modal_header"></div><div id="redactor_modal_inner"></div></div>'),t("body").append(this.modal)),t("#redactor_modal_close").click(t.proxy(this.modalClose,this)),this.hdlModalClose=t.proxy(function(t){if(27===t.keyCode)return this.modalClose(),!1},this),t(document).keyup(this.hdlModalClose),this.$editor.keyup(this.hdlModalClose),0==i.indexOf("#")?t("#redactor_modal_inner").empty().append(t(i).html()):t("#redactor_modal_inner").empty().append(i),t("#redactor_modal_header").html(e),void 0!==t.fn.draggable&&(t("#redactor_modal").draggable({handle:"#redactor_modal_header"}),t("#redactor_modal_header").css("cursor","move")),0!==t("#redactor_tabs").size()){var a=this;t("#redactor_tabs a").each(function(e,i){e++,t(i).click(function(){if(t("#redactor_tabs a").removeClass("redactor_tabs_act"),t(this).addClass("redactor_tabs_act"),t(".redactor_tab").hide(),t("#redactor_tab"+e).show(),t("#redactor_tab_selected").val(e),!1===a.isMobile()){var i=t("#redactor_modal").outerHeight();t("#redactor_modal").css("margin-top","-"+(i+10)/2+"px")}})})}t("#redactor_modal .redactor_btn_modal_close").click(t.proxy(this.modalClose,this)),!1===this.isMobile()?(t("#redactor_modal").css({position:"fixed",top:"-2000px",left:"50%",width:o+"px",marginLeft:"-"+(o+60)/2+"px"}).show(),this.modalSaveBodyOveflow=t(document.body).css("overflow"),t(document.body).css("overflow","hidden")):t("#redactor_modal").css({position:"fixed",width:"100%",height:"100%",top:"0",left:"0",margin:"0",minHeight:"300px"}).show(),"function"==typeof r&&r(),!1===this.isMobile()&&setTimeout(function(){var e=t("#redactor_modal").outerHeight();t("#redactor_modal").css({top:"50%",height:"auto",minHeight:"auto",marginTop:"-"+(e+10)/2+"px"})},20)},modalClose:function(){return t("#redactor_modal_close").unbind("click",this.modalClose),t("#redactor_modal").fadeOut("fast",t.proxy(function(){t("#redactor_modal_inner").html(""),this.opts.overlay&&(t("#redactor_modal_overlay").hide(),t("#redactor_modal_overlay").unbind("click",this.modalClose)),t(document).unbind("keyup",this.hdlModalClose),this.$editor.unbind("keyup",this.hdlModalClose)},this)),!1===this.isMobile()&&t(document.body).css("overflow",this.modalSaveBodyOveflow?this.modalSaveBodyOveflow:"visible"),!1},setModalTab:function(e){t(".redactor_tab").hide();var i=t("#redactor_tabs a");i.removeClass("redactor_tabs_act"),i.eq(e-1).addClass("redactor_tabs_act"),t("#redactor_tab"+e).show()},uploadInit:function(e,i){this.uploadOptions={url:!1,success:!1,error:!1,start:!1,trigger:!1,auto:!1,input:!1},t.extend(this.uploadOptions,i),0!==t("#"+e).size()&&"INPUT"===t("#"+e).get(0).tagName?(this.uploadOptions.input=t("#"+e),this.element=t(t("#"+e).get(0).form)):this.element=t("#"+e),this.element_action=this.element.attr("action"),this.uploadOptions.auto?t(this.uploadOptions.input).change(t.proxy(function(){this.element.submit(function(t){return!1}),this.uploadSubmit()},this)):this.uploadOptions.trigger&&t("#"+this.uploadOptions.trigger).click(t.proxy(this.uploadSubmit,this))},uploadSubmit:function(){this.uploadForm(this.element,this.uploadFrame())},uploadFrame:function(){this.id="f"+Math.floor(99999*Math.random());var e=this.document.createElement("div"),i='<iframe style="display:none" id="'+this.id+'" name="'+this.id+'"></iframe>';return e.innerHTML=i,t(e).appendTo("body"),this.uploadOptions.start&&this.uploadOptions.start(),t("#"+this.id).load(t.proxy(this.uploadLoaded,this)),this.id},uploadForm:function(e,i){if(this.uploadOptions.input){var o="redactorUploadForm"+this.id,r="redactorUploadFile"+this.id;this.form=t('<form  action="'+this.uploadOptions.url+'" method="POST" target="'+i+'" name="'+o+'" id="'+o+'" enctype="multipart/form-data"></form>'),!1!==this.opts.uploadFields&&"object"==typeof this.opts.uploadFields&&t.each(this.opts.uploadFields,t.proxy(function(e,i){0===i.toString().indexOf("#")&&(i=t(i).val());var o=t("<input/>",{type:"hidden",name:e,value:i});t(this.form).append(o)},this));var a=this.uploadOptions.input,s=t(a).clone();t(a).attr("id",r),t(a).before(s),t(a).appendTo(this.form),t(this.form).css("position","absolute"),t(this.form).css("top","-2000px"),t(this.form).css("left","-2000px"),t(this.form).appendTo("body"),this.form.submit()}else e.attr("target",i),e.attr("method","POST"),e.attr("enctype","multipart/form-data"),e.attr("action",this.uploadOptions.url),this.element.submit()},uploadLoaded:function(){var e,i=t("#"+this.id)[0];if(e=i.contentDocument?i.contentDocument:i.contentWindow?i.contentWindow.document:window.frames[this.id].document,this.uploadOptions.success)if(void 0!==e){var o=e.body.innerHTML.match(/\{(.|\n)*\}/)[0],r=t.parseJSON(o);void 0===r.error?this.uploadOptions.success(r):(this.uploadOptions.error(this,r),this.modalClose())}else alert("Upload failed!"),this.modalClose();this.element.attr("action",this.element_action),this.element.attr("target","")},browser:function(t){var e=navigator.userAgent.toLowerCase(),i=/(chrome)[ \/]([\w.]+)/.exec(e)||/(webkit)[ \/]([\w.]+)/.exec(e)||/(opera)(?:.*version|)[ \/]([\w.]+)/.exec(e)||/(msie) ([\w.]+)/.exec(e)||e.indexOf("compatible")<0&&/(mozilla)(?:.*? rv:([\w.]+)|)/.exec(e)||[];return"version"==t?i[2]:"webkit"==t?"chrome"==i[1]||"webkit"==i[1]:i[1]==t},oldIE:function(){return!!(this.browser("msie")&&parseInt(this.browser("version"),10)<9)},outerHTML:function(e){return t("<p>").append(t(e).eq(0).clone()).html()},normalize:function(t){return parseInt(t.replace("px",""),10)},isMobile:function(t){return!(!0!==t||!/(iPhone|iPod|iPad|BlackBerry|Android)/.test(navigator.userAgent))||!!/(iPhone|iPod|BlackBerry|Android)/.test(navigator.userAgent)}},t.fn.getObject=function(){return this.data("redactor")},t.fn.getEditor=function(){return this.data("redactor").$editor},t.fn.getCode=function(){return t.trim(this.data("redactor").getCode())},t.fn.getText=function(){return this.data("redactor").$editor.text()},t.fn.getSelected=function(){return this.data("redactor").getSelectedHtml()},t.fn.setCode=function(t){this.data("redactor").setCode(t)},t.fn.insertHtml=function(t){this.data("redactor").insertHtml(t)},t.fn.destroyEditor=function(){this.each(function(){void 0!==t(this).data("redactor")&&(t(this).data("redactor").destroy(),t(this).removeData("redactor"))})},t.fn.setFocus=function(){this.data("redactor").$editor.focus()},t.fn.execCommand=function(t,e){this.data("redactor").execCommand(t,e)}}(jQuery),function(t){"use strict";function e(e,i){this.opts=t.extend({url:!1,success:!1,error:!1,preview:!1,uploadFields:!1,text:RLANG.drop_file_here,atext:RLANG.or_choose},i),this.$el=t(e)}t.fn.dragupload=function(t){return this.each(function(){new e(this,t).init()})},e.prototype={init:function(){if(-1===navigator.userAgent.search("MSIE")){this.droparea=t('<div class="redactor_droparea"></div>'),this.dropareabox=t('<div class="redactor_dropareabox">'+this.opts.text+"</div>"),this.dropalternative=t('<div class="redactor_dropalternative">'+this.opts.atext+"</div>"),this.droparea.append(this.dropareabox),this.$el.before(this.droparea),this.$el.before(this.dropalternative),this.dropareabox.bind("dragover",t.proxy(function(){return this.ondrag()},this)),this.dropareabox.bind("dragleave",t.proxy(function(){return this.ondragleave()},this));var e=t.proxy(function(t){var e=parseInt(t.loaded/t.total*100,10);this.dropareabox.text("Loading "+e+"%")},this),i=jQuery.ajaxSettings.xhr();i.upload&&i.upload.addEventListener("progress",e,!1);var o=function(){return i};this.dropareabox.get(0).ondrop=t.proxy(function(e){e.preventDefault(),this.dropareabox.removeClass("hover").addClass("drop");var i=e.dataTransfer.files[0],r=new FormData;!1!==this.opts.uploadFields&&"object"==typeof this.opts.uploadFields&&t.each(this.opts.uploadFields,t.proxy(function(e,i){0===i.toString().indexOf("#")&&(i=t(i).val()),r.append(e,i)},this)),r.append("file",i),t.ajax({url:this.opts.url,dataType:"html",data:r,xhr:o,cache:!1,contentType:!1,processData:!1,type:"POST",success:t.proxy(function(e){var i=t.parseJSON(e);void 0===i.error?this.opts.success(i):(this.opts.error(this,i),this.opts.success(!1))},this)})},this)}},ondrag:function(){return this.dropareabox.addClass("hover"),!1},ondragleave:function(){return this.dropareabox.removeClass("hover"),!1}}}(jQuery),function(t){"use strict";var e=/(^|&lt;|\s)(www\..+?\..+?)(\s|&gt;|$)/g,i=/(^|&lt;|\s)(((https?|ftp):\/\/|mailto:).+?)(\s|&gt;|$)/g,o=function(){for(var r=this.childNodes,a=r.length;a--;){var s=r[a];if(3===s.nodeType){var n=s.nodeValue;n&&(n=n.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(e,'$1<a href="http://$2">$2</a>$3').replace(i,'$1<a href="$2">$2</a>$5'),t(s).after(n).remove())}else 1!==s.nodeType||/^(a|button|textarea)$/i.test(s.tagName)||o.call(s)}};t.fn.linkify=function(){this.each(o)}}(jQuery),eval(function(t,e,i,o,r,a){if(r=function(t){return(t<40?"":r(parseInt(t/40)))+((t%=40)>35?String.fromCharCode(t+29):t.toString(36))},!"".replace(/^/,String)){for(;i--;)a[r(i)]=o[i]||r(i);o=[function(t){return a[t]}],r=function(){return"\\w+"},i=1}for(;i--;)o[i]&&(t=t.replace(new RegExp("\\b"+r(i)+"\\b","g"),o[i]));return t}('(5($){$.1.4.7={t:5(0,v){$(2).0("8",c);$(2).0("r",0);$(2).l(\'g\',$.1.4.7.b)},u:5(0){$(2).w(\'g\',$.1.4.7.b)},b:5(1){9 0=$(2).0("r");9 3=$.1.4.7.f(0).h();6(3!=\'\'){$(2).0("8",x);1.j="7";1.3=3;$.1.i.m(2,k)}},f:5(0){9 3=\'\';6(q.e){3=q.e()}o 6(d.e){3=d.e()}o 6(d.p){3=d.p.B().3}A 3}};$.1.4.a={t:5(0,v){$(2).0("n",0);$(2).0("8",c);$(2).l(\'g\',$.1.4.a.b);$(2).l(\'D\',$.1.4.a.s)},u:5(0){$(2).w(\'g\',$.1.4.a.b)},b:5(1){6($(2).0("8")){9 0=$(2).0("n");9 3=$.1.4.7.f(0).h();6(3==\'\'){$(2).0("8",c);1.j="a";$.1.i.m(2,k)}}},s:5(1){6($(2).0("8")){9 0=$(2).0("n");9 3=$.1.4.7.f(0).h();6((1.y=z)&&(3==\'\')){$(2).0("8",c);1.j="a";$.1.i.m(2,k)}}}}})(C);',0,40,"data|event|this|text|special|function|if|textselect|textselected|var|textunselect|handler|false|rdocument|getSelection|getSelectedText|mouseup|toString|handle|type|arguments|bind|apply|rttt|else|selection|rwindow|ttt|handlerKey|setup|teardown|namespaces|unbind|true|keyCode|27|return|createRange|jQuery|keyup".split("|"),0,{}));
